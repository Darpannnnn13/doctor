<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Book Appointment - Smart Health</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: linear-gradient(to right, #0f2027, #203a43, #2c5364); color: white; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .glass-container { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 24px; 
            width: 100%; 
            max-width: 900px; 
            display: flex;
            flex-direction: column;
            md:flex-row;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .info-panel {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.1));
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .form-panel { padding: 40px; flex-grow: 1; }
        
        .dynamic-info {
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
        }
        .dynamic-info.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="glass-container md:flex-row flex-col animate__animated animate__fadeIn">
        <!-- Left Panel: Dynamic Info -->
        <div class="info-panel md:w-1/3 border-b md:border-b-0 md:border-r border-white/10">
            <h2 class="text-3xl font-bold mb-2 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">Appointment Details</h2>
            <p class="text-gray-400 text-sm mb-8">Select a doctor to view consultation details.</p>
            
            <div id="doctorInfo" class="dynamic-info">
                <div class="mb-6">
                    <span class="text-xs text-blue-300 uppercase font-bold tracking-wider">Consultation Fee</span>
                    <div class="text-3xl font-bold text-white mt-1" id="feeDisplay">--</div>
                </div>
                
                <div class="mb-6">
                    <span class="text-xs text-blue-300 uppercase font-bold tracking-wider">Type</span>
                    <div class="text-lg text-white mt-1" id="typeDisplay">--</div>
                </div>

                <div class="mb-6" id="addressBox" style="display: none;">
                    <span class="text-xs text-blue-300 uppercase font-bold tracking-wider">Clinic Address</span>
                    <p class="text-sm text-gray-300 mt-1 leading-relaxed" id="addressDisplay">--</p>
                </div>

                <div class="p-4 bg-blue-500/10 rounded-xl border border-blue-500/20">
                    <p class="text-xs text-blue-200" id="emailNote">ℹ️ Select a doctor to see booking info.</p>
                </div>
            </div>
        </div>

        <!-- Right Panel: Form -->
        <div class="form-panel md:w-2/3">
            <form action="/book_appointment" method="POST" class="space-y-5">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Select Specialist</label>
                    <select name="doctor_name" id="doctorSelect" onchange="updateDoctorInfo()" required 
                        class="w-full bg-black/20 border border-white/20 p-3 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
                        <option value="" data-fee="0" data-type="" data-address="">-- Choose Doctor --</option>
                        {% for doctor in doctors %}
                        <option value="{{ doctor.name }}" 
                                data-fee="{{ doctor.consultation_fees }}" 
                                data-type="{{ doctor.consultation_type }}" 
                                data-address="{{ doctor.clinic_address }}"
                                {% if doctor.name == selected_doctor %}selected{% endif %}>
                            {{ doctor.name }} ({{ doctor.specialty }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Preferred Date</label>
                        <input type="date" name="date" required class="w-full bg-black/20 border border-white/20 p-3 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <!-- Time slot is handled via email as per requirement, so we don't ask for it here or we could add a preference -->
                </div>

                <div>
                    <label class="block text-sm text-gray-400 mb-1">Symptoms / Reason</label>
                    <textarea name="symptoms" required class="w-full bg-black/20 border border-white/20 p-3 rounded-xl text-white h-32 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Briefly explain your health concern..."></textarea>
                </div>

                <button type="submit" id="submitBtn" class="w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-xl font-bold shadow-lg shadow-blue-500/20 hover:scale-[1.02] transition text-lg">
                    Book Appointment
                </button>
                <a href="/" class="block text-center text-sm text-gray-400 mt-4 hover:text-white">Cancel</a>
            </form>
        </div>
    </div>

    <script>
        function updateDoctorInfo() {
            const select = document.getElementById('doctorSelect');
            const option = select.options[select.selectedIndex];
            const infoDiv = document.getElementById('doctorInfo');
            
            if (select.value === "") {
                infoDiv.classList.remove('visible');
                document.getElementById('submitBtn').innerText = "Book Appointment";
                return;
            }

            const fee = option.getAttribute('data-fee');
            const type = option.getAttribute('data-type');
            const address = option.getAttribute('data-address');

            // Update Text
            document.getElementById('feeDisplay').innerText = `₹${fee}`;
            document.getElementById('typeDisplay').innerText = type;
            document.getElementById('submitBtn').innerText = `Pay ₹${fee} & Book`;

            // Handle Address & Email Note
            const addressBox = document.getElementById('addressBox');
            const emailNote = document.getElementById('emailNote');

            if (type.includes('Clinic')) {
                addressBox.style.display = 'block';
                document.getElementById('addressDisplay').innerText = address;
                emailNote.innerText = "ℹ️ Confirmed time slot will be sent to your registered email.";
            } else {
                addressBox.style.display = 'none';
                emailNote.innerText = "ℹ️ Google Meet link and time will be sent to your registered email.";
            }

            infoDiv.classList.add('visible');
        }

        // Initialize if a doctor is pre-selected
        window.addEventListener('DOMContentLoaded', () => {
            const select = document.getElementById('doctorSelect');
            if (select.value) {
                updateDoctorInfo();
            }
        });
    </script>
</body>
</html>